webpackJsonp([21],{"77cS":function(e,t){},QjFX:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("//Fk"),n=a.n(r),o=a("mvHQ"),i=a.n(o),s=a("1N4U"),c=a("1CjK"),l=a("3r8y"),u=a("Gtft"),d=a("N6PA"),m=a("6D10"),p=a("heE5"),f={name:"user-box",props:{form:{type:[Object,String],default:function(){return{img:"",title:"",name:"",date:""}}}}},v={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"user-box"},[a("p",{staticClass:"left"},[e.form.img?a("img",{staticClass:"img",attrs:{src:e.form.img||e.$images.all.img_man01,alt:"img"}}):a("span",{staticClass:"img-name"},[e._v(e._s(e.form.name))]),e._v(" "),e.form.title?a("span",{staticClass:"title"},[e._v(e._s(e.form.title)+":")]):e._e(),e._v(" "),e.form.name?a("span",{staticClass:"name"},[e._v(e._s(e.form.name))]):e._e()]),e._v(" "),a("p",{staticClass:"right"},[e.form.date?a("span",{staticClass:"date"},[e._v(e._s(e.form.date))]):e._e()])])},staticRenderFns:[]};var y=a("VU/8")(f,v,!1,function(e){a("77cS")},"data-v-d453de48",null).exports,h={name:"quoted-add",extends:l.a,components:{UserBox:y},created:function(){var e=this;this.$nextTick(function(){e.params=e.$route.params;var t=e.params;t&&"add"===t.type?(e.id=t.id,e.form.type="add"):(e.id=t.id,e.form.type="edit"),e.userInfo.img=e.$store.state.user.avatar,e.userInfo.name=e.$store.state.user.name,e.userInfo.date=(new Date).format("yyyy-MM-dd"),"add"===e.form.type&&e.getPage({})})},activated:function(){u.a.setRight()},computed:{btnName:function(){return"edit"===this.params?"编辑报价":"提交报价"}},data:function(){return{initData:null,clueId:"",id:"",template:null,userInfo:{title:"报价人",name:"李明清",date:"2018-04-08 19:30"},form:{type:"add",data:[]},edit:null}},methods:{isEdit:function(){return this.initData!==i()(this.form)},onBtnClick:function(){var e=this;console.log(this.form,"==>form");var t=[];this.$refs.va.forEach(function(e){e.rules&&!Object(m.j)(e)&&t.push(e.changeV())}),n.a.all(t).then(function(t){if(t.every(function(e){return e})){console.log(e.form,"校验成功并提交数据");var a=[];e.form.data.forEach(function(t){var r={};t.forEach(function(e){if("group"!==e.attr){var t="";t=e.value?e.value:0===e.value?0:e.text,console.log(t,"item"),"appearance"===e.attr&&(t=t&&i()(t)),"interior"===e.attr&&(t=t&&i()(t)),"estimateObtainTime"===e.attr&&e.text&&(t=Object(p.a)(e.text)),"billingTime"===e.attr&&e.text&&(t=Object(p.a)(e.text)),r[e.attr]=t}}),r.resourceLocation=e.$ChangeType.xToType(r.resourceLocation,"number"),r.quotedPrice=e.$ChangeType.xToType(r.quotedPrice,"float"),r.trafficPrice=e.$ChangeType.xToType(r.trafficPrice,"float"),r.procedureTracks=e.$ChangeType.xToType(r.procedureTracks,"number"),r.deliveryTime=e.$ChangeType.xToType(r.deliveryTime,"float"),r.productionTime=e.$ChangeType.xToType(r.productionTime,"number"),r.insuranceType=e.$ChangeType.xToType(r.insuranceType,"number"),r.invoicePrice=e.$ChangeType.xToType(r.invoicePrice,"float"),r.invoiceType=e.$ChangeType.xToType(r.invoiceType,"number"),r.resourceAreaCode=e.$ChangeType.xToType(r.resourceAreaCode,"string"),r.remarks=e.$ChangeType.xToType(r.remarks,"string"),a.push(r)}),console.log(a,"==>datas"),a.length<=0?e.$AlertUtil.showToast({txt:"请添加报价",icon:"warn"}):"add"===e.form.type?(console.log(e.form.data),console.log(a,"==>add"),Object(s.b)({id:e.id,obj:a}).then(function(){e.params.onSuccess&&e.params.onSuccess(),e.$router.go(-1)}).catch(function(e){return console.log(e)})):e.form.type}})},onBtnAddTmp:function(){var e=this.template&&JSON.parse(this.template);this.form.data.push(e)},onBtnDel:function(e){this.form.data.splice(e,1)},onCarModel:function(e,t){var a=this;console.log(e,"data");var r=e.data.innerColors,n=e.data.outerColors;this.form.data.forEach(function(e,o){"appearance"===e.attr&&(t||(a.form.data[o].text="",a.form.data[o].value=null),n&&(a.form.data[o].selData=n)),"interior"===e.attr&&(t||(a.form.data[o].text="",a.form.data[o].value=null),r&&(a.form.data[o].selData=r))}),t&&(this.initData=i()(this.form))},selClue:function(e){var t=this;console.log(e," 123 "),this.form.data.forEach(function(a,r){if("clueLevel"===a.attr&&(t.form.data[r].text=e.intentionGrade.name,t.form.data[r].value=e.intentionGrade.code),"vehicleModelId"===a.attr&&(t.form.data[r].text=e.carName,t.form.data[r].value=e.vehicleModelId),"appearance"===a.attr){var n=JSON.parse(e.appearance);t.form.data[r].text=n&&n.name,t.form.data[r].value=n||null}if("interior"===a.attr){var o=JSON.parse(e.interior),i=o&&o.colors&&o.colors[0].name;o.colors&&o.colors[1]&&(i+="/"+o.colors[1].name),t.form.data[r].text=i,t.form.data[r].value=o||null}"shoppingWay"===a.attr&&(t.form.data[r].text=e.shoppingWay.name,t.form.data[r].value=e.shoppingWay.code)})},getPage:function(e){var t=this;console.log(e,"edit-----\x3e>>>>");var a=this.menu,r=a.clueAdditionalConfiguration,n=a.clueIntentionType,o=a.clueIntentionGrade,l=a.clueShoppingWay,u=a.gender,m=a.customerOrigin,p=a.customerType,f=a.resourceLocation,v=a.insuranceType,y=a.invoiceType,h=a.carSourceType,g=a.productionTime;Object(s.f)().then(function(a){console.log(a,"==>module");var s=[];a.forEach(function(e){"create-quoted"===e.code&&"add"===t.form.type&&(s=e.fields),"edit-quoted"===e.code&&"edit"===t.form.type&&(s=e.fields)}),s.sort(function(e,t){return e.sort-t.sort});var x=[],b=s.length;s.forEach(function(a,i){var s={attr:a.attr,type:c.a[a.configsObj.type],title:a.name,text:null,value:null,placeholder:a.configsObj.placeholder,indent:!0,columnWidth:a.columnWidth,selData:{source:[],selectedKey:""},line:b-1!==i};"clueId"===a.attr&&(s.params=t.params),"clueLevel"===s.attr&&(s.disable=!0),"vehicleModelId"===s.attr&&(s.singleChoose=!0,s.disable=!0),"appearance"===s.attr&&(s.disable=!0),"interior"===s.attr&&(s.disable=!0),"guidancePrice"===s.attr&&(s.disable=!0),"shoppingWay"===s.attr&&(s.disable=!0),"procedureTracks"===s.attr&&(s.unit="个工作日"),e[s.attr]&&(s.value=e[s.attr],s.text=e[s.attr],console.log(s.attr,"attr"),"clueId"===s.attr&&(s.text=e[s.attr].name,s.value=e[s.attr].code),"clueLevel"===s.attr&&(s.text=e[s.attr].name,s.value=e[s.attr].code),"vehicleModelId"===s.attr&&(s.text=e[s.attr].name,s.value=e[s.attr].code),"appearance"===s.attr&&(console.log(e[s.attr],"dddddd"),s.text=e[s.attr].name,s.value=e[s.attr]?JSON.parse(e[s.attr].code):null),"interior"===s.attr&&(s.text=e[s.attr].name,s.value=e[s.attr]?JSON.parse(e[s.attr].code):null),"shoppingWay"===s.attr&&(s.text=e[s.attr].name,s.value=e[s.attr].code),"customerType"===s.attr&&(s.text=e[s.attr].name,s.value=e[s.attr].code),"areaId"===s.attr&&(s.text=e[s.attr].name,s.value=e[s.attr].code),"estimateObtainTime"===s.attr&&(s.text=e[s.attr],s.value=e[s.attr]),"billingDemand"===s.attr&&(s.text=e[s.attr],s.value=e[s.attr]),"billingTime"===s.attr&&(s.text=e[s.attr],s.value=e[s.attr]),"demand"===s.attr&&(s.text=e[s.attr],s.value=e[s.attr]),"remarks"===s.attr&&(s.text=e[s.attr],s.value=e[s.attr]));var T=!1;a.rulesObj&&a.rulesObj.forEach(function(e){"required"===e.type&&(T=!0)});var C=Object(d.a)(a);switch(T&&(s.required=T),C&&(s.rules=C),a.attr){case"vehicleModelId":s.selData.source=r.map(function(e){return{key:e.name,value:e.code}});break;case"intentionType":s.selData.source=n.map(function(e){return{key:e.name,value:e.code}});break;case"clueLevel":s.selData.source=o.map(function(e){return{key:e.name,value:e.code}});break;case"intentionGrade":s.selData.source=n.map(function(e){return{key:e.name,value:e.code}});break;case"shoppingWay":s.selData.source=l.map(function(e){return{key:e.name,value:e.code}});break;case"appearance":case"interior":s.selData=null;break;case"gender":s.selData.source=u.map(function(e){return{key:e.name,value:e.code}});break;case"origin":s.selData.source=m.map(function(e){return{key:e.name,value:e.code}});break;case"customerType":s.selData.source=p.map(function(e){return{key:e.name,value:e.code}});break;case"resourceLocation":s.selData.source=f.map(function(e){return{key:e.name,value:e.code}});break;case"insuranceType":s.selData.source=v.map(function(e){return{key:e.name,value:e.code}});break;case"invoiceType":s.selData.source=y.map(function(e){return{key:e.name,value:e.code}});break;case"carSourceType":s.selData.source=h&&h.map(function(e){return{key:e.name,value:e.code}})||[];break;case"productionTime":s.selData.source=g&&g.map(function(e){return{key:e.name,value:e.code}})||[]}x.push(s)}),t.template=i()(x),t.form.data.push(x),t.initData=i()(t.form)}).catch(function(e){console.log(e,"==============================>err")})}}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("div",{staticClass:"input-box2"},[a("cube-scroll",[a("div",{staticClass:"content"},[a("UserBox",{attrs:{form:e.userInfo}}),e._v(" "),e._l(e.form.data,function(t,r){return[a("div",{key:r,staticClass:"inputBox"},[a("div",{staticClass:"section-title title-box"},[a("p",[e._v("报价内容-"+e._s(r+1))]),e._v(" "),a("yi-touch",{staticClass:"del-box",on:{click:function(t){e.onBtnDel(r)}}},[a("p",[e._v("删除")])])],1),e._v(" "),e._l(t,function(t,r){return["customerId"===t.attr?a("div",{key:"index"+r,staticClass:"id-box"},e._l(e.form.info,function(t,r){return a("div",{key:"index2"+r,staticClass:"in-box",class:{self:50===t.columnWidth}},[a("yi-input",e._b({ref:"info",refInFor:!0,attrs:{value:t.value,indent:!0,selData:t.selData||null,clearMR:50===t.columnWidth,disable:!0},on:{"update:value":function(a){e.$set(t,"value",a)}},model:{value:t.text,callback:function(a){e.$set(t,"text",a)},expression:"item1.text"}},"yi-input",t,!1))],1)})):"groupHeader"===t.type?a("div",{key:"index"+r,staticClass:"section-title section-margin-top"},[e._v("\n                "+e._s(t.title)+"\n              ")]):a("div",{key:"index"+r,staticClass:"in-box",class:{self:50===t.columnWidth}},[a("yi-input",e._b({ref:"va",refInFor:!0,attrs:{value:t.value,indent:!0,selData:t.selData||null,clearMR:50===t.columnWidth},on:{"update:value":function(a){e.$set(t,"value",a)},onCarModel:e.onCarModel,selClue:e.selClue},model:{value:t.text,callback:function(a){e.$set(t,"text",a)},expression:"item.text"}},"yi-input",t,!1))],1)]})],2)]}),e._v(" "),a("div",{staticClass:"btn-content"},[a("yi-btn-box",{staticClass:"btnBox",attrs:{add:!0,name:"添加报价"},on:{onBtnClick:e.onBtnAddTmp}})],1)],2)])],1),e._v(" "),a("yi-btn-box",{attrs:{name:e.btnName},on:{onBtnClick:e.onBtnClick}})],1)},staticRenderFns:[]};var x=a("VU/8")(h,g,!1,function(e){a("nvSh")},"data-v-40159519",null);t.default=x.exports},nvSh:function(e,t){}});