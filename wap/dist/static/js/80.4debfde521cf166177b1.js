webpackJsonp([80],{"7hGF":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("//Fk"),n=a.n(r),o=a("mvHQ"),i=a.n(o),l=a("1N4U"),u=a("1CjK"),c=a("3r8y"),s=a("Gtft"),d=a("N6PA"),m=a("6D10"),p=a("heE5"),f=a("t5DY"),v=a("laDb"),y={name:"quotedRecord-add",extends:c.a,created:function(){var e=this;this.$nextTick(function(){e.params=e.$route.params;var t=e.params;t&&t.id?(e.id=t.id,e.form.type="edit"):e.form.type="add","add"===e.form.type?e.getPage({}):"all"===e.params.type&&e.getPage({})})},activated:function(){s.a.setRight()},updated:function(){if(!this.inquiryInfoHeight){var e=document.getElementById("inquiry");if(e){var t=e.offsetHeight;e.style.height=t+"px",this.inquiryInfoHeight=t}}var a=document.querySelectorAll("#inquiry .name");if(a){var r=a&&a[0]&&a[0].offsetWidth;a&&a.forEach(function(e){e.offsetWidth>r&&(r=e.offsetWidth)}),a&&a.forEach(function(e){e.style.width=r+"px"})}},computed:{btnName:function(){return"add"!==this.params.type?"编辑报价记录":"新建报价记录"}},data:function(){return{initData:null,clueId:"",id:"",template:null,selQuoted:{attr:"selClue",type:"selClue",title:"选择报价单",text:null,value:null,placeholder:"请选择报价单",indent:!0,rules:{required:!0},required:!0,line:!1,params:{type:"quotedPrice",condition:{isSelect:["1"]}}},form:{type:"add",inquiryData:[],data:[]},edit:null,more:!0,inquiryInfoHeight:0}},methods:{isEdit:function(){return this.initData!==i()(this.form)},onBtnClick:function(){var e=this;console.log(this.form),console.log(this.$refs.va,"==>va");var t=[];t.push(this.$refs.va1.changeV()),this.$refs.va.forEach(function(e){e.rules&&!Object(m.j)(e)&&t.push(e.changeV())}),console.log(t,"--------"),n.a.all(t).then(function(t){if(t.every(function(e){return e})){console.log(e.form,"校验成功并提交数据");var a=[];e.form.data.forEach(function(t){var r={};t.forEach(function(e){if("group"!==e.attr){var t="";t=e.value?e.value:0===e.value?0:e.text,console.log(t,"item"),"appearance"===e.attr&&(t=t&&i()(t)),"interior"===e.attr&&(t=t&&i()(t)),"estimateObtainTime"===e.attr&&e.text&&(t=Object(p.a)(e.text)),"billingTime"===e.attr&&e.text&&(t=Object(p.a)(e.text)),"productionTime"===e.attr&&e.text&&(t=Object(p.a)(e.text)),r[e.attr]=t}}),r.resourceLocation=e.$ChangeType.xToType(r.resourceLocation,"number"),r.quotedPrice=e.$ChangeType.xToType(r.quotedPrice,"float"),r.trafficPrice=e.$ChangeType.xToType(r.trafficPrice,"float"),r.procedureTracks=e.$ChangeType.xToType(r.procedureTracks,"number"),r.deliveryTime=e.$ChangeType.xToType(r.deliveryTime,"float"),r.productionTime=e.$ChangeType.xToType(r.productionTime,"string"),r.insuranceType=e.$ChangeType.xToType(r.insuranceType,"number"),r.invoicePrice=e.$ChangeType.xToType(r.invoicePrice,"float"),r.invoiceType=e.$ChangeType.xToType(r.invoiceType,"number"),r.resourceAreaCode=e.$ChangeType.xToType(r.resourceAreaCode,"string"),r.remarks=e.$ChangeType.xToType(r.remarks,"string"),a.push(r)}),a.length<=0?e.$AlertUtil.showToast({txt:"请添加报价",icon:"warn"}):"add"===e.form.type?(console.log(e.form.data),console.log(a,"==>add"),Object(l.b)({id:e.id,obj:a}).then(function(t){console.log(t,"==>success"),t&&(e.params.onSuccess&&e.params.onSuccess(),e.$RouteUtil.commonDetail({module:"quotedRecords",id:t,BACK_ACTION:e.params.BACK_ACTION}))}).catch(function(e){return console.log(e)})):e.form.type}})},onlink:function(e){e&&v.a.commonDetail({module:"clues",id:e})},onBtnAddTmp:function(){var e=this.template&&JSON.parse(this.template);this.form.data.push(e)},handleMore:function(){this.more=!this.more;var e=document.getElementById("inquiry"),t=document.getElementsByClassName("inputInfo"),a=t[t.length-1].offsetHeight,r=e.offsetHeight-4*a+2;e.style.height=(this.more?this.inquiryInfoHeight:r)+"px"},onBtnDel:function(e){this.form.data.splice(e,1)},onCarModel:function(e,t){var a=this;console.log(e,"data");var r=e.data.innerColors,n=e.data.outerColors;this.form.data.forEach(function(e,o){"appearance"===e.attr&&(t||(a.form.data[o].text="",a.form.data[o].value=null),n&&(a.form.data[o].selData=n)),"interior"===e.attr&&(t||(a.form.data[o].text="",a.form.data[o].value=null),r&&(a.form.data[o].selData=r))}),t&&(this.initData=i()(this.form))},onPriceOrder:function(e){var t=this;console.log(e,"==>ooooo"),this.selQuoted.text=e.quotedNo||e.id,this.selQuoted.value=e.id,this.id=e.id,Object(f.g)({module:"quotedPrices",id:e.id}).then(function(e){console.log(e),t.form.inquiryData.forEach(function(a,r){a.forEach(function(a,n){e[a.attr]&&(t.form.inquiryData[r][n].text=e[a.attr],t.form.inquiryData[r][n].value=e[a.attr]),"clueNo"===a.attr&&(t.form.inquiryData[r][n].text=e.clueNo,t.form.inquiryData[r][n].value=e.clueId,t.form.inquiryData[r][n].link=!0),"clueStatus"===a.attr&&(t.form.inquiryData[r][n].text=e.clueStatus.name,t.form.inquiryData[r][n].value=e.clueStatus.code),"clueLevel"===a.attr&&(t.form.inquiryData[r][n].text=e.clueLevel.name,t.form.inquiryData[r][n].value=e.clueLevel.code),"vehicleModelId"===a.attr&&(t.form.inquiryData[r][n].text=e.vehicleModel,t.form.inquiryData[r][n].value=e.vehicleModelId),"appearance"===a.attr&&(t.form.inquiryData[r][n].text=e.appearance&&JSON.parse(e.appearance)&&JSON.parse(e.appearance).name,t.form.inquiryData[r][n].value=null),"interior"===a.attr&&(t.form.inquiryData[r][n].text=e.interior&&JSON.parse(e.interior)&&JSON.parse(e.interior).colors[0].name,t.form.inquiryData[r][n].value=e.interior),"guidingPrice"===a.attr&&(t.form.inquiryData[r][n].text=e.guidingPrice,t.form.inquiryData[r][n].value=e.guidingPrice),"shoppingWay"===a.attr&&(t.form.inquiryData[r][n].text=e.shoppingWay.name,t.form.inquiryData[r][n].value=e.shoppingWay.code),"customerType"===a.attr&&(t.form.inquiryData[r][n].text=e.customerType.name,t.form.inquiryData[r][n].value=e.customerType.code),"areaId"===a.attr&&(t.form.inquiryData[r][n].text=e.area,t.form.inquiryData[r][n].value=e.areaId),"estimateObtainTime"===a.attr&&(t.form.inquiryData[r][n].text=e.estimateObtainTime,t.form.inquiryData[r][n].value=e.estimateObtainTime),"billingDemand"===a.attr&&(t.form.inquiryData[r][n].text=e.billingDemand,t.form.inquiryData[r][n].value=e.billingDemand),"billingTime"===a.attr&&(t.form.inquiryData[r][n].text=e.billingTime,t.form.inquiryData[r][n].value=e.billingTime),"demand"===a.attr&&(t.form.inquiryData[r][n].type="text",t.form.inquiryData[r][n].text=e.demand,t.form.inquiryData[r][n].value=e.demand),"remarks"===a.attr&&(t.form.inquiryData[r][n].type="text",t.form.inquiryData[r][n].text=e.remarks,t.form.inquiryData[r][n].value=e.remarks)})})}).catch(function(e){console.log(e)})},selClue:function(e){var t=this;console.log(e," 123 "),this.form.data.forEach(function(a,r){if("clueLevel"===a.attr&&(t.form.data[r].text=e.intentionGrade.name,t.form.data[r].value=e.intentionGrade.code),"vehicleModelId"===a.attr&&(t.form.data[r].text=e.carName,t.form.data[r].value=e.vehicleModelId),"appearance"===a.attr){var n=JSON.parse(e.appearance);t.form.data[r].text=n&&n.name,t.form.data[r].value=n||null}if("interior"===a.attr){var o=JSON.parse(e.interior),i=o&&o.colors&&o.colors[0].name;o.colors&&o.colors[1]&&(i+="/"+o.colors[1].name),t.form.data[r].text=i,t.form.data[r].value=o||null}"shoppingWay"===a.attr&&(t.form.data[r].text=e.shoppingWay.name,t.form.data[r].value=e.shoppingWay.code)})},getPage:function(e){var t=this;console.log(e,"edit-----\x3e>>>>");var a=this.menu,r=a.clueAdditionalConfiguration,n=a.clueIntentionType,o=a.clueIntentionType,c=a.clueShoppingWay,s=a.gender,m=a.customerOrigin,p=a.customerType,f=a.resourceLocation,v=a.insuranceType,y=a.invoiceType;Object(l.e)().then(function(a){console.log(a,"==>module");var i=[];a.forEach(function(e){"info-inquiry"===e.code&&(i=e.fields)}),i.sort(function(e,t){return e.sort-t.sort});var l=[];i.forEach(function(a){var i={attr:a.attr,type:u.a[a.configsObj.type],title:a.name,text:null,value:null,placeholder:"无",indent:!0,columnWidth:a.columnWidth,selData:{source:[],selectedKey:""}};if("clueId"===a.attr&&(i.params=t.params),"clueLevel"===i.attr&&(i.disable=!0),"vehicleModelId"===i.attr&&(i.singleChoose=!0,i.disable=!0),"appearance"===i.attr&&(i.disable=!0),"interior"===i.attr&&(i.disable=!0),"guidancePrice"===i.attr&&(i.disable=!0),"shoppingWay"===i.attr&&(i.disable=!0),"demand"===i.attr&&(i.type="text"),e[i.attr]){if(i.value=e[i.attr],i.text=e[i.attr],console.log(i.attr,"attr"),"clueId"===i.attr&&(i.text=e.clueNo,i.value=e[i.attr]),"clueLevel"===i.attr&&(i.text=e[i.attr].name,i.value=e[i.attr].code),"vehicleModelId"===i.attr&&(i.text=e.vehicleModel,i.value=e[i.attr]),"appearance"===i.attr&&(console.log(e[i.attr],"dddddd"),i.text=e[i.attr].name,i.value=e[i.attr]?JSON.parse(e[i.attr].code):null),"interior"===i.attr){var h=e[i.attr]&&JSON.parse(e[i.attr]).colors&&JSON.parse(e[i.attr]).colors[0].name;JSON.parse(e[i.attr]).colors&&JSON.parse(e[i.attr]).colors[1]&&(h+="/"+JSON.parse(e[i.attr]).colors[1].name),i.text=h,i.value=e[i.attr]?JSON.parse(e[i.attr].code):null}"shoppingWay"===i.attr&&(i.text=e[i.attr].name,i.value=e[i.attr].code),"customerType"===i.attr&&(i.text=e[i.attr].name,i.value=e[i.attr].code),"areaId"===i.attr&&(i.text=e.area,i.value=e[i.attr]),"estimateObtainTime"===i.attr&&(i.text=e[i.attr],i.value=e[i.attr]),"billingDemand"===i.attr&&(i.text=e[i.attr],i.value=e[i.attr]),"billingTime"===i.attr&&(i.text=e[i.attr],i.value=e[i.attr]),"demand"===i.attr&&(i.text=e[i.attr],i.value=e[i.attr]),"remarks"===i.attr&&(i.text=e[i.attr],i.value=e[i.attr])}var g=!1;a.rulesObj&&a.rulesObj.forEach(function(e){"required"===e.type&&(g=!0)});var x=Object(d.a)(a);switch(g&&(i.required=g),x&&(i.rules=x),a.attr){case"vehicleModelId":i.selData.source=r.map(function(e){return{key:e.name,value:e.code}});break;case"intentionType":i.selData.source=n.map(function(e){return{key:e.name,value:e.code}});break;case"clueLevel":i.selData.source=o.map(function(e){return{key:e.name,value:e.code}});break;case"intentionGrade":i.selData.source=n.map(function(e){return{key:e.name,value:e.code}});break;case"shoppingWay":i.selData.source=c.map(function(e){return{key:e.name,value:e.code}});break;case"appearance":case"interior":i.selData=null;break;case"gender":i.selData.source=s.map(function(e){return{key:e.name,value:e.code}});break;case"origin":i.selData.source=m.map(function(e){return{key:e.name,value:e.code}});break;case"customerType":i.selData.source=p.map(function(e){return{key:e.name,value:e.code}});break;case"resourceLocation":i.selData.source=f.map(function(e){return{key:e.name,value:e.code}});break;case"insuranceType":i.selData.source=v.map(function(e){return{key:e.name,value:e.code}});break;case"invoiceType":i.selData.source=y.map(function(e){return{key:e.name,value:e.code}})}l.push(i)}),console.log(l,"==>inquiryData"),t.form.inquiryData.push(l)}).catch(function(e){console.log(e,"==============================>err")}),Object(l.f)().then(function(a){console.log(a,"==>module123");var l=[];a.forEach(function(e){"create-quoted"===e.code&&"add"===t.form.type?l=e.fields:"edit-quoted"===e.code&&"edit"===t.form.type?l=e.fields:"create-quoted"===e.code&&"all"===t.params.type&&(l=e.fields)}),l.sort(function(e,t){return e.sort-t.sort});var h=[],g=l.length;l.forEach(function(a,i){var l={attr:a.attr,type:u.a[a.configsObj.type],title:a.name,text:null,value:null,placeholder:a.configsObj.placeholder,indent:!0,columnWidth:a.columnWidth,selData:{source:[],selectedKey:""},line:g-1!==i};"clueId"===a.attr&&(l.params=t.params),"clueLevel"===l.attr&&(l.disable=!0),"vehicleModelId"===l.attr&&(l.singleChoose=!0,l.disable=!0),"appearance"===l.attr&&(l.disable=!0),"interior"===l.attr&&(l.disable=!0),"guidancePrice"===l.attr&&(l.disable=!0),"shoppingWay"===l.attr&&(l.disable=!0),"procedureTracks"===l.attr&&(l.unit="个工作日"),e[l.attr]&&(l.value=e[l.attr],l.text=e[l.attr],console.log(l.attr,"attr"),"clueId"===l.attr&&(l.text=e[l.attr].name,l.value=e[l.attr].code),"clueLevel"===l.attr&&(l.text=e[l.attr].name,l.value=e[l.attr].code),"vehicleModelId"===l.attr&&(l.text=e[l.attr].name,l.value=e[l.attr].code),"appearance"===l.attr&&(console.log(e[l.attr],"dddddd"),l.text=e[l.attr].name,l.value=e[l.attr]?JSON.parse(e[l.attr].code):null),"interior"===l.attr&&(l.text=e[l.attr].name,l.value=e[l.attr]?JSON.parse(e[l.attr].code):null),"shoppingWay"===l.attr&&(l.text=e[l.attr].name,l.value=e[l.attr].code),"customerType"===l.attr&&(l.text=e[l.attr].name,l.value=e[l.attr].code),"areaId"===l.attr&&(l.text=e[l.attr].name,l.value=e[l.attr].code),"estimateObtainTime"===l.attr&&(l.text=e[l.attr],l.value=e[l.attr]),"billingDemand"===l.attr&&(l.text=e[l.attr],l.value=e[l.attr]),"billingTime"===l.attr&&(l.text=e[l.attr],l.value=e[l.attr]),"demand"===l.attr&&(l.text=e[l.attr],l.value=e[l.attr]));var x=!1;a.rulesObj&&a.rulesObj.forEach(function(e){"required"===e.type&&(x=!0)});var b=Object(d.a)(a);switch(x&&(l.required=x),b&&(l.rules=b),a.attr){case"vehicleModelId":l.selData.source=r.map(function(e){return{key:e.name,value:e.code}});break;case"intentionType":l.selData.source=n.map(function(e){return{key:e.name,value:e.code}});break;case"clueLevel":l.selData.source=o.map(function(e){return{key:e.name,value:e.code}});break;case"intentionGrade":l.selData.source=n.map(function(e){return{key:e.name,value:e.code}});break;case"shoppingWay":l.selData.source=c.map(function(e){return{key:e.name,value:e.code}});break;case"appearance":case"interior":l.selData=null;break;case"gender":l.selData.source=s.map(function(e){return{key:e.name,value:e.code}});break;case"origin":l.selData.source=m.map(function(e){return{key:e.name,value:e.code}});break;case"customerType":l.selData.source=p.map(function(e){return{key:e.name,value:e.code}});break;case"resourceLocation":l.selData.source=f.map(function(e){return{key:e.name,value:e.code}});break;case"insuranceType":l.selData.source=v.map(function(e){return{key:e.name,value:e.code}});break;case"invoiceType":l.selData.source=y.map(function(e){return{key:e.name,value:e.code}})}h.push(l)}),t.template=i()(h),t.form.data.push(h),t.initData=i()(t.form)}).catch(function(e){console.log(e,"==============================>err")})}}},h={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("div",{staticClass:"input-box2"},[a("cube-scroll",[a("div",{staticClass:"content"},["all"!==e.params.type?a("yi-input",e._b({ref:"va1",attrs:{value:e.selQuoted.value},on:{"update:value":function(t){e.$set(e.selQuoted,"value",t)},selClue:e.onPriceOrder},model:{value:e.selQuoted.text,callback:function(t){e.$set(e.selQuoted,"text",t)},expression:"selQuoted.text"}},"yi-input",e.selQuoted,!1)):e._e(),e._v(" "),e._l(e.form.inquiryData,function(t,r){return"all"!==e.params.type?[a("div",{key:"in"+r,staticStyle:{flex:"1",transition:"all .2s linear",overflow:"hidden"},attrs:{id:"inquiry"}},[a("div",{staticClass:"section-title title-box inquiry-title"},[a("p",[e._v("询价信息")])]),e._v(" "),e._l(t,function(t,r){return["group"!==t.attr?a("yi-input",e._b({key:"inquiry"+r,staticClass:"inputInfo",attrs:{title:t.title+"：",value:t.value,indent:!1,disable:!0,direction:!0,rules:{}},on:{"update:value":function(a){e.$set(t,"value",a)},onLink:e.onlink},model:{value:t.text,callback:function(a){e.$set(t,"text",a)},expression:"item.text"}},"yi-input",t,!1)):e._e()]})],2)]:e._e()}),e._v(" "),"all"!==e.params.type?a("div",{staticClass:"p-more"},[a("yi-touch",{staticClass:"show-more",attrs:{"component-name":"p"},on:{click:e.handleMore}},[e._v("\n            "+e._s(e.more?"收起询价详情":"展开询价详情")+"\n            "),e.more?a("img",{staticClass:"ico-more",attrs:{src:e.$images.follow.angle_top,alt:"img"}}):a("img",{staticClass:"ico-more",attrs:{src:e.$images.follow.angle_bottom,alt:"img"}})])],1):e._e(),e._v(" "),e._l(e.form.data,function(t,r){return[a("div",{key:r,staticClass:"inputBox"},[a("div",{staticClass:"section-title title-box"},[a("p",[e._v("报价内容-"+e._s(r+1))]),e._v(" "),a("yi-touch",{staticClass:"del-box",on:{click:function(t){e.onBtnDel(r)}}},[a("p",[e._v("删除")])])],1),e._v(" "),e._l(t,function(t,r){return["customerId"===t.attr?a("div",{key:"index"+r,staticClass:"id-box"},e._l(e.form.info,function(t,r){return a("div",{key:"index2"+r,staticClass:"in-box",class:{self:50===t.columnWidth}},[a("yi-input",e._b({ref:"info",refInFor:!0,attrs:{value:t.value,indent:!0,selData:t.selData||null,clearMR:50===t.columnWidth,disable:!0},on:{"update:value":function(a){e.$set(t,"value",a)}},model:{value:t.text,callback:function(a){e.$set(t,"text",a)},expression:"item1.text"}},"yi-input",t,!1))],1)})):"groupHeader"===t.type?a("div",{key:"index"+r,staticClass:"section-title section-margin-top"},[e._v("\n                "+e._s(t.title)+"\n              ")]):a("div",{key:"index"+r,staticClass:"in-box",class:{self:50===t.columnWidth}},[a("yi-input",e._b({ref:"va",refInFor:!0,attrs:{value:t.value,indent:!0,selData:t.selData||null,clearMR:50===t.columnWidth},on:{"update:value":function(a){e.$set(t,"value",a)},onCarModel:e.onCarModel,selClue:e.selClue},model:{value:t.text,callback:function(a){e.$set(t,"text",a)},expression:"item.text"}},"yi-input",t,!1))],1)]})],2)]}),e._v(" "),"all"!==e.params.type?a("div",{staticClass:"btn-content"},[a("yi-btn-box",{staticClass:"btnBox",attrs:{add:!0,name:"添加报价"},on:{onBtnClick:e.onBtnAddTmp}})],1):e._e()],2)])],1),e._v(" "),"all"!==e.params.type?a("yi-btn-box",{attrs:{name:e.btnName},on:{onBtnClick:e.onBtnClick}}):e._e()],1)},staticRenderFns:[]};var g=a("VU/8")(y,h,!1,function(e){a("ozU6")},"data-v-075ad91e",null);t.default=g.exports},ozU6:function(e,t){}});