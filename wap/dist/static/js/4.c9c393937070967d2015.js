webpackJsonp([4],{"4CJb":function(e,t){},tOPd:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("Xxa5"),n=a.n(r),o=a("exGp"),s=a.n(o),c=a("Dd8w"),l=a.n(c),i=a("//Fk"),u=a.n(i),p=a("mvHQ"),d=a.n(p),f=a("yelY"),m=a("1CjK"),h=a("3r8y"),g=a("Gtft"),v=a("N6PA"),y=a("heE5"),k=a("6D10"),b={name:"plan-add",extends:h.a,created:function(){var e=this;this.params=this.$route.params;var t=this.params;t&&t.id?(this.id=t.id,this.form.type="edit"):this.form.type="add","add"===this.form.type?this.getPage({}):Object(f.j)(this.id).then(function(t){e.getPage(t)}).catch(function(e){console.log(e)})},data:function(){return{initData:null,id:null,params:this.$route.params,form:{type:"add",data:[]},hasValue:!1}},methods:{isEdit:function(){return this.initData!==d()(this.form)},onBtnClick:function(){var e=this,t=this.$refs.va.map(function(e){return e.changeV()});u.a.all(t).then(function(t){if(t.every(function(e){return e})){console.log(e.form,"校验成功并提交数据");var a={};e.form.data.forEach(function(e){if("group"!==e.attr){var t="";t=e.value?e.value:0===e.value?0:e.text,console.log(t,"item"),a[e.attr]=t}"remark"===e.attr&&(a[e.attr]=e.text),"responsibleId"===e.attr&&(e.text.length<=0?a[e.attr]="":a[e.attr]=e.text&&e.text[e.text.length-1]),"teamworkIds"===e.attr&&(""===e.text?a[e.attr]=[]:a[e.attr]=e.text)});var r=a.plannedTime;a.plannedTime=Object(y.a)(r);a.target={customer:0,clue:1,agent:2}[e.params.type]||0,console.log(a,"校验成功并提交数据--01"),console.log(e.form),"add"===e.form.type?Object(f.a)(a).then(function(t){console.log(t),console.log("要直接跳详情"),e.$RouteUtil.commonDetail(l()({},e.params,{id:t})),console.log(t,"--------01---------")}).catch(function(e){console.log(e,"--------02---------")}):"edit"===e.form.type&&(a.id=e.id,console.log(a),Object(f.d)(a).then(function(t){console.log(t,""),e.params.onSuccess&&e.params.onSuccess(),e.$router.go(-1)}).catch(function(e){return console.log(e)}))}})},getPage:function(e){var t=this;return s()(n.a.mark(function a(){var r,o,s,c,l,i,u,p,h,g,y,b,x,O,$;return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(r=t.menu,o=r.followUpTarget,s=[],c=r.clueAdditionalConfiguration,l=null,i=null,u=r.clueIntentionType,p=r.clueShoppingWay,h=r.gender,g=r.customerOrigin,y=r.customerType,"clue"===t.params.type||"agent"===t.params.type){a.next=16;break}return a.next=14,Object(f.m)(""+t.params.type);case 14:b=a.sent,s=b.map(function(e){return{key:e.description,value:e.value}});case 16:return a.next=18,Object(f.e)();case 18:x=a.sent,console.log(x,"=========================>success"),O=[],x.forEach(function(e){console.log(e),"create-follow-up"===e.code&&"add"===t.form.type&&(O=e.fields),"edit-follow-up"===e.code&&"edit"===t.form.type&&(O=e.fields)}),O.sort(function(e,t){return e.sort-t.sort}),$=[],O.forEach(function(a){var r={attr:a.attr,type:m.a[a.configsObj.type],title:a.name,text:"",value:null,placeholder:a.configsObj.placeholder,indent:!1,selData:{source:[{key:"下单客户1",value:1},{key:"下单客户2",value:2}],selectedKey:"下单客户1"}};if("targetId"===a.attr&&("agent"===t.params.type&&(r.title="跟进经纪人",r.placeholder="请选择跟进经纪人"),"customer"===t.params.type&&(r.title="跟进客户",r.placeholder="请选择跟进客户"),r.params=t.params),e[r.attr]){if(r.value=e[r.attr],r.text=e[r.attr],"targetId"===r.attr&&("agent"===t.params.type&&(r.title="跟进经纪人",r.placeholder="请选择跟进经纪人"),r.text=e.targetId.targetName,r.value=e.targetId.targetId,r.disable=!0,t.getExecutor(r.value,t.params.type)),"plannedTime"===r.attr){var n=e.plannedTime;n.length>10&&(n=n.substring(0,10)),r.text=n,r.value=n}if("purpose"===r.attr){var d="";s.forEach(function(t){t.value===e[r.attr]&&(d=t.key)}),r.text=d,r.value=e[r.attr]}"responsibleId"===r.attr&&(r.text=[e.responsibleId]),"teamworkIds"===r.attr&&(r.text=e.teamworkIds),"remark"===r.attr&&(r.text=Object(k.d)(e[r.attr]),r.value=Object(k.d)(e[r.attr]))}var f=!1;a.rulesObj&&a.rulesObj.forEach(function(e){"required"===e.type&&(f=!0)});var b=Object(v.a)(a);switch(f&&(r.required=f),b&&(r.rules=b),a.attr){case"target":r.selData.source=o.map(function(e){return{key:e.name,value:e.code}});break;case"purpose":r.selData.source=s;break;case"vehicleModelId":r.selData.source=c.map(function(e){return{key:e.name,value:e.code}});break;case"intentionType":case"intentionGrade":r.selData.source=u.map(function(e){return{key:e.name,value:e.code}});break;case"shoppingWay":r.selData.source=p.map(function(e){return{key:e.name,value:e.code}});break;case"appearance":r.selData=l;break;case"interior":r.selData=i;break;case"gender":r.selData.source=h.map(function(e){return{key:e.name,value:e.code}});break;case"origin":r.selData.source=g.map(function(e){return{key:e.name,value:e.code}});break;case"type":r.selData.source=y.map(function(e){return{key:e.name,value:e.code}})}$.push(r)}),t.form.data=$,console.log(t.form.data,"-----031"),t.initData=d()(t.form);case 28:case"end":return a.stop()}},a,t)}))()},getExecutor:function(e,t){var a=this;t=t||this.params.type,console.log(this.params),Object(f.f)({id:e,type:t}).then(function(e){console.log(e,"负责人"),console.log(a.$refs.check),console.log(a.$refs.check[1].$attrs.attr),a.$refs.check&&(a.$refs.check.forEach(function(t){t.$attrs&&t.$attrs.attr&&"responsibleId"===t.$attrs.attr&&(t.newOptions=e.responsibleMans.map(function(e){return{label:e.userName,value:e.userId}}),console.log(t.newOptions,"==>负责")),t.$attrs&&t.$attrs.attr&&"teamworkIds"===t.$attrs.attr&&(t.newOptions=e.teamworkMans.map(function(e){return{label:e.userName,value:e.userId}}),console.log(t.newOptions,"==>协同"))}),a.hasValue=!0)}).catch(function(e){console.log(e,"负责人错误")})},selClue:function(e){this.getExecutor(e.id)}},activated:function(){g.a.setRight()}},x={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("div",{staticClass:"input-box2"},[a("cube-scroll",[e._l(e.form.data,function(t,r){return["groupHeader"===t.type&&e.hasValue?a("div",{key:r,staticClass:"title",attrs:{attr:t.attr}},[e._v(e._s(t.title))]):e._e(),e._v(" "),"checkbox"===t.type?a("yi-check",e._b({key:r,ref:"check",refInFor:!0,attrs:{checkList:t.text,options:[]},on:{"update:checkList":function(a){e.$set(t,"text",a)}}},"yi-check",t,!1)):"purpose"!==t.attr||"clue"!==e.params.type&&"agent"!==e.params.type?"groupHeader"!==t.type?a("yi-input",e._b({key:r,ref:t.rules.required?"va":null,refInFor:!0,attrs:{indent:!0,value:t.value,selData:t.selData||null,line:r===e.form.data.length-1,lineTop:0!=r,params:t.params},on:{"update:value":function(a){e.$set(t,"value",a)},selClue:e.selClue},model:{value:t.text,callback:function(a){e.$set(t,"text",a)},expression:"item.text"}},"yi-input",t,!1)):e._e():a("div",{key:r,staticStyle:{display:"none"}})]})],2)],1),e._v(" "),a("yi-btn-box",{attrs:{name:"确认提交"},on:{onBtnClick:e.onBtnClick}})],1)},staticRenderFns:[]};var O=a("VU/8")(b,x,!1,function(e){a("4CJb")},"data-v-7b59d58a",null);t.default=O.exports}});