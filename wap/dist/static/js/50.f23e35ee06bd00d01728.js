webpackJsonp([50],{D1wz:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,n,u,i=a("mvHQ"),l=a.n(i),s=a("//Fk"),c=a.n(s),o=a("Xxa5"),d=a.n(o),p=a("Dd8w"),m=a.n(p),x=a("exGp"),v=a.n(x),f=a("t5DY"),y=a("yelY"),g=a("6D10"),h=(a("laDb"),this),b={customers:{title:"客户跟进",transformData:function(e){var t=e.$route.params,a=t.targetName,r=t.targetId,n={text:"",value:""},u={text:"",value:""},i="",l="";e.isEditMode&&e.data&&(n.text=e.data.way.name,n.value=e.data.way.code,u.text=e.data.purpose,u.value=e.data.purpose,l=e.data.record,i=e.data.nextExecutionTime?e.data.nextExecutionTime.split(" ")[0]:"",a=e.params.targetName,r=e.params.targetId);var s=e.$store.state.menu.followUpWay.map(function(e){return{key:e.name,value:e.code}});return[{type:"selCustomer",title:"跟进客户",text:a,tag:"targetId",value:r,placeholder:"请输入客户名称",indent:!1,disable:!!r,required:!0},{type:"select",title:"跟进方式",text:n.text,value:n.value,tag:"way",placeholder:"请选择跟进方式",selData:{source:s},rules:{required:!0,empty:!0},required:!0},{type:"ajaxSelect",title:"下次跟进目的",text:u.text,value:u.value,selData:{resource:function(){return Object(y.m)("customer").then(function(e){return e.map(function(e){return{key:e.value,value:e.value}})})}},tag:"purpose",placeholder:"请选择下次跟进目的",rules:{required:!1}},{type:"date",title:"下次跟进时间",text:i,value:i,tag:"nextExecutionTime",min:new Date,placeholder:"请选择下次跟进时间",rules:{required:!1,empty:!0},required:!1},{type:"textarea",title:"跟进记录",text:l,placeholder:"请输入跟进记录",tag:"record",rules:{required:!0,empty:!0,min:5,max:100},required:!0}]},commit:(u=v()(d.a.mark(function e(t,a){var r,n;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.params.id,!t.isEditMode){e.next=6;break}return e.next=4,Object(f.z)(m()({targetId:t.data.targetId,id:r,target:0},Object(g.g)(a)));case 4:e.next=10;break;case 6:return n=m()({targetId:r,target:0},Object(g.g)(a)),t.params.planId&&(n.planId=t.params.planId),e.next=10,Object(f.y)(n);case 10:t.params.onSuccess&&t.params.onSuccess(),t.$router.go(-1);case 12:case"end":return e.stop()}},e,h)})),function(e,t){return u.apply(this,arguments)})},agents:{transformData:function(e){var t=e.$route.params,a=t.targetName,r=t.targetId,n={text:"",value:""},u={text:"",value:""},i="",l="";e.isEditMode&&e.data&&(n.text=e.data.way.name,n.value=e.data.way.code,u.text=e.data.purpose,u.value=e.data.purpose,l=e.data.record,i=e.data.nextExecutionTime?e.data.nextExecutionTime.split(" ")[0]:"",a=e.params.targetName,r=e.params.targetId);var s=e.$store.state.menu.followUpWay.map(function(e){return{key:e.name,value:e.code}});return[{type:"selAgent",title:"跟进经纪人",tag:"targetId",text:a,value:r,placeholder:"请输入跟进经纪人",disable:!!r,required:!0},{type:"select",title:"跟进方式",text:n.text,value:n.value,tag:"way",placeholder:"请选择跟进方式",rules:{required:!0},selData:{source:s},required:!0},{type:"ajaxSelect",title:"跟进目的",text:u.text,value:u.value,selData:{resource:function(){return Object(y.m)("agent").then(function(e){return e.map(function(e){return{key:e.value,value:e.value}})})}},tag:"purpose",placeholder:"请选择跟进目的",rules:{required:!1}},{type:"date",title:"下次跟进时间",text:i,tag:"nextExecutionTime",value:i,min:new Date,placeholder:"请选择下次跟进时间",rules:{required:!0},required:!0},{type:"text",title:"跟进记录",text:l,tag:"record",placeholder:"请输入跟进记录",rules:{required:!0,empty:!0,min:5,max:100},required:!0}]},commit:(n=v()(d.a.mark(function e(t,a){var r;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.params.id,!t.isEditMode){e.next=6;break}return e.next=4,Object(f.z)(m()({targetId:t.data.targetId,id:r,target:2},Object(g.g)(a)));case 4:e.next=8;break;case 6:return e.next=8,Object(f.y)(m()({targetId:r,target:2},Object(g.g)(a)));case 8:t.params.onSuccess&&t.params.onSuccess(),t.$router.back();case 10:case"end":return e.stop()}},e,h)})),function(e,t){return n.apply(this,arguments)})},clues:{title:"线索跟进",transformData:function(e){var t=e.$route.params,a=t.targetName,r=t.targetId,n={text:"",value:""},u={text:"",value:""},i={text:"",value:""},l="",s="";e.isEditMode&&e.data&&(n.text=e.data.way.name,n.value=e.data.way.code,i.text=e.data.clueLevel.name,i.value=e.data.clueLevel.code,u.text=e.data.purpose,u.value=e.data.purpose,s=e.data.record,l=e.data.nextExecutionTime?e.data.nextExecutionTime.split(" ")[0]:"",a=e.params.targetName,r=e.params.targetId);var c=e.$store.state.menu.followUpWay.filter(function(e){return"无"!==e.name}).map(function(e){return{key:e.name,value:e.code}}),o=e.$store.state.menu.clueIntentionGrade.filter(function(e){return"无"!==e.name}).map(function(e){return{key:e.name,value:e.code}});return[{type:"selClue",title:"跟进线索",text:a,value:r,tag:"targetId",params:{type:"clue"},placeholder:"请选择线索",rules:{required:!0},disable:!!r,required:!0},{type:"select",title:"跟进方式",text:n.text,value:n.value,tag:"way",placeholder:"请选择跟进方式",selData:{source:c},rules:{required:!0},required:!0},{type:"select",title:"线索等级",text:i.text,value:i.value,tag:"clueLevel",selData:{source:o},placeholder:"请选择线索等级",rules:{required:!0},required:!0,disable:e.isEditMode},{type:"date",title:"下次跟进时间",min:new Date,text:l,value:l,tag:"nextExecutionTime",placeholder:"请选择下次跟进时间",rules:{required:!0},disable:!0,required:!0},{type:"textarea",title:"跟进记录",text:s,tag:"record",placeholder:"请输入跟进记录",rules:{required:!0,empty:!0,min:5,max:100},required:!0}]},commit:(r=v()(d.a.mark(function e(t,a){var r;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.params.id,!t.isEditMode){e.next=6;break}return e.next=4,Object(f.z)(m()({targetId:t.data.targetId,id:r,target:1},Object(g.g)(a)));case 4:e.next=8;break;case 6:return e.next=8,Object(f.y)(m()({targetId:r,target:1},Object(g.g)(a)));case 8:t.params.onSuccess&&t.params.onSuccess(),t.$router.go(-1);case 10:case"end":return e.stop()}},e,h)})),function(e,t){return r.apply(this,arguments)})}},M=a("Gtft"),j=a("3r8y"),q=a("heE5"),w={name:"CommonFollowUp",extends:j.a,data:function(){var e=this.$route.params;return{data:null,isEditMode:"edit"===e.type,form:b[e.module].transformData(this),initData:b[e.module].transformData(this)}},methods:{onBtnClick:function(){var e=this,t=[];this.$refs.va.forEach(function(e){e.rules&&!Object(g.j)(e)&&t.push(e.changeV())}),c.a.all(t).then(function(t){t.every(function(e){return e})&&b[e.params.module].commit(e,e.form)})}},computed:{clueLevelParams:function(){return"clues"===this.params.module?this.form[2].text:null},purposeParams:function(){var e=this.form.findIndex(function(e){return"purpose"===e.tag});return-1===e?null:this.form[e].text}},watch:{clueLevelParams:function(e){if("clues"===this.params.module&&!this.isEditMode){var t=this.form[3];switch(e){case"H":t.disable=!0,t.text=Object(q.c)(-1,"yyyy-MM-dd"),t.value=Object(q.c)(-1,"yyyy-MM-dd");break;case"A":t.disable=!0,t.text=Object(q.c)(-3,"yyyy-MM-dd"),t.value=Object(q.c)(-3,"yyyy-MM-dd");break;case"B":t.disable=!1,t.text=Object(q.c)(-15,"yyyy-MM-dd"),t.value=Object(q.c)(-15,"yyyy-MM-dd");break;case"C":t.disable=!1,t.text=Object(q.c)(-30,"yyyy-MM-dd"),t.value=Object(q.c)(-30,"yyyy-MM-dd")}}},purposeParams:function(e){var t=this.form.findIndex(function(e){return"nextExecutionTime"===e.tag});if(-1!==t){var a=this.form[t];a.rules.required=!!e,a.required=!!e}}},mounted:function(){var e=this;this.isEditMode&&Object(f.k)(this.params.id).then(function(t){e.data=t;var a=b[e.params.module].transformData(e);e.form=a,console.log("form",a),e.initData=JSON.parse(l()(a))})},activated:function(){M.a.setTitle({title:b[this.params.module].title}),M.a.setRight()}},k={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"follow-up app-init"},[a("div",{staticClass:"input-box"},[a("cube-scroll",[e._l(e.form,function(t,r){return[a("yi-input",e._b({key:r,ref:t.rules?"va":null,refInFor:!0,attrs:{value:t.value,selData:t.selData||null,indent:!0},on:{"update:value":function(a){e.$set(t,"value",a)}},model:{value:t.text,callback:function(a){e.$set(t,"text",a)},expression:"item.text"}},"yi-input",t,!1))]})],2)],1),e._v(" "),a("yi-btn-box",{attrs:{name:"确认提交"},on:{onBtnClick:e.onBtnClick}})],1)},staticRenderFns:[]};var O=a("VU/8")(w,k,!1,function(e){a("Ma54")},"data-v-7222f1a1",null);t.default=O.exports},Ma54:function(e,t){}});