webpackJsonp([55],{"4KJJ":function(e,t){},F7Jn:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("Xxa5"),o=a.n(r),n=a("exGp"),s=a.n(n),l=a("Dd8w"),i=a.n(l),c=a("bOdI"),u=a.n(c),d=a("mvHQ"),f=a.n(d),p=a("pFYg"),m=a.n(p),v=a("//Fk"),y=a.n(v),h=a("ViqS"),g=a.n(h),b=a("FWz8"),x=a("1CjK"),T=a("3r8y"),k=a("Gtft"),$=a("N6PA"),U=a("6D10"),O={name:"order-add",extends:T.a,created:function(){var e=this;this.$nextTick(function(){e.params=e.$route.params,console.log(e.params,"-----------\x3e0203");var t=e.params;t&&t.id?(e.id=t.id,e.form.type="edit"):e.form.type="add","add"===e.form.type?e.getPage({}):e.params.oldData&&e.getPage(e.params.oldData)})},activated:function(){k.a.setRight(),this.params.id?k.a.setTitle({title:"编辑合同"}):k.a.setTitle({title:"付款与交车"})},computed:{btnName:function(){return this.id?"确认编辑":"创建合同"}},data:function(){return{initData:null,params:this.$route.params,clueId:"",id:"",isOnline:!1,orderType:null,form:{type:"add",info:[{attr:"name",type:"text",title:"客户名称",text:null,value:null,placeholder:"请选择客户名称1",required:!1,indent:!1},{attr:"mobile",type:"text",title:"联系电话",text:null,value:null,placeholder:"客户联系电话",required:!1,indent:!1},{attr:"gender",type:"text",title:"性别",text:null,value:null,placeholder:"请选择性别",required:!1,indent:!1}],data:[]},edit:null}},methods:{isEdit:function(){return this.$store.dispatch("order/getData4",this.form.data),!1},onBtnClick:function(){var e=this;console.log(this.form);var t=[];this.$refs.va.forEach(function(e){e.rules&&!Object(U.j)(e)&&t.push(e.changeV())}),console.log(t,"--------"),y.a.all(t).then(function(t){var a=t.every(function(e){return e});if(a&&(e.$store.dispatch("order/getData4",e.form.data),console.log(a),a)){console.log(e.form,"校验成功并提交数据");var r=[],o=[],n=[];e.form.data.map(function(e){if("contractUrl"===e.attr){var t=e.value||[];r=t.map(function(e){return e.url})}if("certificateUrl"===e.attr){var a=e.value||[];o=a.map(function(e){return e.url})}if("depositVoucherUrl"===e.attr){var s=e.value||[];n=s.map(function(e){return e.url})}}),e.params.data4=e.form.data,console.log(e.params,"4444");var s=e.params,l=[];s.data1 instanceof Array&&(l=l.concat(s.data1)),s.data2 instanceof Array&&(l=l.concat(s.data2)),s.data3 instanceof Array&&(l=l.concat(s.data3)),s.data4 instanceof Array&&(l=l.concat(s.data4)),console.log(l);var c=l.filter(function(e){return"group"!==e.attr&&"files"!==e.attr}).map(function(e){var t="";return t=e.value?e.value:0===e.value?0:e.text,"belongStoreId"===e.attr&&("object"===m()(e.value)?t=e.value&&e.value.id:"string"==typeof e.value&&(t=e.value&&JSON.parse(e.value)&&JSON.parse(e.value).id)),"appearance"!==e.attr&&"interior"!==e.attr||(t="无"===t?null:t&&f()(t)||""),u()({},e.attr,t)}),d={};c.forEach(function(e){for(var t in e)d[t]=e[t]}),console.log(d,"itemssss"),d.cluePK||delete d.cluePK,d.gender=parseInt(d.gender),d.shoppingWay=parseInt(d.shoppingWay),d.appearance=e.$ChangeType.xToType(d.appearance,"string"),d.interior=e.$ChangeType.xToType(d.interior,"string"),console.log(d,"--\x3e>>123"),d.contractUrl&&(d.contractUrl=r),d.certificateUrl&&(d.certificateUrl=o),d.depositVoucherUrl&&(d.depositVoucherUrl=n);var p=!0;if(d.contractUrl&&d.contractUrl.forEach(function(e){(e&&"string"!=typeof e||-1!==e.indexOf("blob:"))&&(p=!1)}),d.certificateUrl&&d.certificateUrl.forEach(function(e){(e&&"string"!=typeof e||-1!==e.indexOf("blob:"))&&(p=!1)}),d.depositVoucherUrl&&d.depositVoucherUrl.forEach(function(e){(e&&"string"!=typeof e||-1!==e.indexOf("blob:"))&&(p=!1)}),!p)return e.$AlertUtil.showToast({txt:"您传的图片未成功，请重新选择图片",type:"warn"}),!1;if(e.$AlertUtil.isEmpty(d.contractUrl))return e.$AlertUtil.showToast({txt:"您传的委托订单合同未成功，请重新选择图片",type:"warn"}),!1;if(!e.isOnline&&e.$AlertUtil.isEmpty(d.certificateUrl))return e.$AlertUtil.showToast({txt:"您传的身份证/营业执照未成功，请重新选择图片",type:"warn"}),!1;if(e.$AlertUtil.isEmpty(d.depositVoucherUrl))return e.$AlertUtil.showToast({txt:"您传的客户定金凭证未成功，请重新选择图片",type:"warn"}),!1;e.isOnline&&delete d.contractUrl,"add"===e.form.type?Object(b.a)(d).then(function(t){console.log(t,"res001"),e.params.onSuccess&&e.params.onSuccess(),e.$RouteUtil.orderAddSuccess(i()({},e.params,{module:"order",type:"all",ico:"",title:e.isOnline?"完成创建":"创建成功",name:"新建订单",content:e.isOnline?'<p style="line-height:20px;">订单'+t.no+'完成创建，</p><p style="line-height:20px;">合同一小时内有效，请告知客户在手机上签约订单。</p>':"",isContent:!0,btnName:"查看",customerNo:t.no,id:t.orderId})),console.log(t,"--------01---------")}).catch(function(e){console.log(e,"--------02---------")}):(d.orderId=e.params.oldData.id,d.customerId=e.params.oldData.customerId,d.orderNo=e.params.oldData.orderNo,e.$RouteUtil.orderAddSuccess(i()({},e.params,{isBack:!0,ico:e.isOnline?e.$images.order.ic_cancel:"",title:e.isOnline?"签约内容将发送至客户":"修改成功",name:"客户确认",content:e.isOnline?'<p style="line-height:20px;">签约内容将发送至客户进行确认。</p><p style="line-height:20px;"><span style="color:red;">请确保修改内容的完整</span>，是否继续？</p>':"",isContent:!0,btns:[{name:"取消",event:function(){e.$RouteUtil.back(e.params.BACK_ACTION)}},{name:"确认",event:function(){Object(b.e)(d).then(function(t){console.log(t,"==>edit success"),e.params.onSuccess&&e.params.onSuccess(),e.$RouteUtil.back(e.params.BACK_ACTION),e.$AlertUtil.showToast({txt:"修改成功"})}).catch(function(e){return console.log(e,"==>edit err")})}}]})))}return!1})},onGetName:function(e){this.$refs.va.forEach(function(t){console.log(t),"name"===t.$attrs.attr&&t.setText(e)})},onChangeMoney:function(e){var t=this;console.log(e,"obj");var a=0,r=0;if(("totalAmount"===e.type||"deposit"===e.type)&&(console.log("要联动了"),this.form.data.forEach(function(e){"totalAmount"===e.attr&&e.value&&(a=g()(e.value).format("0.00")),"deposit"===e.attr&&e.value&&(r=g()(e.value).format("0.00"))}),a&&r)){var o=g()(a-r).format("0,0.00");this.form.data.forEach(function(e,a){"balance"===e.attr&&(t.form.data[a].text=o,t.form.data[a].value=g()(o).format("0.00"))})}},onSelect:function(e,t){var a=this;if("deliveryPlaceType"===e.type)switch(e.value=this.$ChangeType.xToType(e.value,"string"),console.log(e.value),console.log(m()(e.value),"pppppppppp"),e.value){case"0":this.form.data.forEach(function(e,r){"deliveryPlace"===e.attr&&(t||(a.form.data[r].text=a.params.storeAddress,a.form.data[r].value=a.params.storeAddress),a.form.data[r].disable=!0)});break;case"1":this.form.data.forEach(function(r,o){"deliveryPlace"===r.attr&&(t||(a.form.data[o].text=e.address||"",a.form.data[o].value=e.address||""),a.form.data[o].disable=!1)})}},onCarModel:function(e,t){var a=this;console.log(e,"data");var r=e.data.innerColors,o=e.data.outerColors;this.form.data.forEach(function(e,n){"appearance"===e.attr&&(t||(a.form.data[n].text=null,a.form.data[n].value=null),o?(a.form.data[n].selData=o,a.form.data[n].disable=!1,a.form.data[n].text=null):(a.form.data[n].selData=null,a.form.data[n].disable=!0,a.form.data[n].text="无")),"interior"===e.attr&&(t||(a.form.data[n].text=null,a.form.data[n].value=null),r?(a.form.data[n].selData=r,a.form.data[n].disable=!1,a.form.data[n].text=null):(a.form.data[n].selData=null,a.form.data[n].disable=!0,a.form.data[n].text="无"))}),t&&(this.initData=f()(this.form))},getAgent:function(e){var t=this;return s()(o.a.mark(function a(){var r,n;return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(r=JSON.parse(f()(e)),n=[],a.prev=2,!t.$store.state.order.storeId){a.next=14;break}return a.next=6,Object(b.s)({storeId:t.$store.state.order.storeId,orderType:t.$store.state.order.orderType,userId:t.$store.state.order.customerNo});case 6:n=a.sent,r.text=n&&n[0]&&n[0].name||"",r.value=n&&n[0]&&n[0].id||"",r.disable=!0,r.type="text",r.selData={source:[]},a.next=22;break;case 14:return a.next=16,Object(b.r)({id:t.$store.state.user.id});case 16:n=a.sent,r.text=n&&n[0]&&n[0].name||"",r.value=n&&n[0]&&n[0].id||"",r.disable=!1,r.type="select",r.selData={source:n&&n.map(function(e){return{key:e.name,value:e.id}})};case 22:a.next=27;break;case 24:a.prev=24,a.t0=a.catch(2),console.log("报错了==>",a.t0);case 27:return console.log(r),a.abrupt("return",r);case 29:case"end":return a.stop()}},a,t,[[2,24]])}))()},getAllAcount:function(){var e=0,t=1;return this.params.data1.forEach(function(e){if(console.log("==>item1",e),"amount"===e.attr){try{e.value=parseInt(e.value)}catch(t){e.value=1}t=e.value}}),this.params.data3.forEach(function(t){if("insuranceExpensesType"!==t.attr&&"insuranceCompany"!==t.attr&&"purchaseTaxType"!==t.attr&&"additionalProvisions"!==t.attr&&"group"!==t.attr){try{t.value=parseFloat(item.value)}catch(e){}e=parseFloat(e)+parseFloat(t.value)}}),e*t},getPage:function(e){var t=this;return s()(o.a.mark(function a(){var r,n,l,i,c,u,d,p,m,v,y,h,T,k;return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:console.log(e),r=t.menu,n=r.clueAdditionalConfiguration,l=null,i=null,c=r.clueIntentionType,u=r.clueShoppingWay,d=r.gender,p=r.customerOrigin,m=r.customerType,v=r.paymentWay,y=r.deliveryPlaceType,h=r.deliveryPlace,t.isOnline=!1;try{t.params.data2.forEach(function(){var e=s()(o.a.mark(function e(a){var r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("orderType"!==a.attr){e.next=7;break}return a.value=a.value.toString(),t.orderType=a.value,e.next=5,Object(b.k)(a.value);case 5:r=e.sent,t.isOnline=!!r;case 7:case"end":return e.stop()}},e,t)}));return function(t){return e.apply(this,arguments)}}())}catch(e){console.log(e)}if(console.log("---------------------------------------------------------"),!t.$store.state.order.data4){a.next=22;break}return t.form.data=t.$store.state.order.data4,T=t.getAllAcount(),k=null,t.form.data.forEach(function(e){"totalAmount"===e.attr&&(e.text=g()(T).format("0,0.00"),e.value=g()(T).format("0.00")),"deposit"===e.attr&&(e.value?k=e.value:0===e.value&&(k=0)),"balance"===e.attr&&k&&(e.text=g()(T-k).format("0,0.00"),e.value=g()(T-k).format("0.00")),"deliveryPlaceType"===e.attr&&(e.text="",e.value=""),"deliveryPlace"===e.attr&&(e.text="",e.value=""),["3","4","5","6","7"].indexOf(t.orderType)>-1&&t.form.data.forEach(function(e,a){"deliveryPlaceType"===e.attr&&(t.form.data[a].text="客户4S店自提",t.form.data[a].value=1,t.form.data[a].disable=!0),"deliveryPlace"===e.attr&&(t.form.data[a].disable=!1)}),"ambassadornId"===e.attr&&(console.log(t.$store.state.order.storeId,"==>storeId"),t.$store.state.order.storeId?Object(b.s)({storeId:t.$store.state.order.storeId,orderType:t.$store.state.order.orderType,userId:t.$store.state.order.customerNo}).then(function(t){console.log(t,"==>>>>>>>>>>res"),e.text=t[0].name,e.value=t[0].id,e.disable=!0}).catch(function(e){return console.log(e)}):Object(b.r)({id:t.$store.state.user.id}).then(function(t){console.log(t,"==>>>>>>>>>>getUsers"),e.text=t[0].name,e.value=t[0].id,e.disable=!1,e.type="select",e.selData={source:t&&t.map(function(e){return{key:e.name,value:e.id}})}}).catch(function(e){return console.log(e)}))}),a.abrupt("return");case 22:Object(b.g)().then(function(a){console.log(a,"=========================>success2");var r=[];a.forEach(function(e){console.log(e),"create-order"===e.code&&"add"===t.form.type&&(r=e.fields),"edit-order"===e.code&&"edit"===t.form.type&&(r=e.fields)}),r.sort(function(e,t){return e.sort-t.sort}),t.allData=r;var o=r.filter(function(e){return"step4"===e.description});console.log(o,"=========================>data2");var s=[];o.forEach(function(a){var r={attr:a.attr,type:x.a[a.configsObj.type],title:a.name,text:null,value:null,placeholder:a.configsObj.placeholder,indent:!0,columnWidth:a.columnWidth,selData:{source:[{key:"选项一",value:1},{key:"选项二",value:2}],selectedKey:"下单客户1"}};if("vehicleModelId"===r.attr&&(r.singleChoose=!0),"totalAmount"===r.attr&&"edit"!==t.form.type&&(r.text=g()(t.getAllAcount()).format("0,0.00"),r.value=g()(t.getAllAcount()).format("0.00")),"totalAmount"===r.attr&&(r.disable=!0),"contractUrl"===r.attr&&(r.line=!1),"certificateUrl"===r.attr&&(r.line=!1),"depositVoucherUrl"===r.attr&&(r.line=!1),"ambassadornId"===r.attr&&(r.disable=!0),"ambassadornId"!==r.attr||e.ambassadorn||(console.log(t.$store.state.order.storeId,"==>storeId"),!e[r.attr]&&t.$store.state.order.storeId?Object(b.s)({storeId:t.$store.state.order.storeId,orderType:t.$store.state.order.orderType,userId:t.$store.state.order.customerNo}).then(function(e){console.log(e,"==>>>>>>>>>>res"),r.text=e[0].name,r.value=e[0].id,r.disable=!0}).catch(function(e){return console.log(e)}):Object(b.r)({id:t.$store.state.user.id}).then(function(e){console.log(e,"==>>>>>>>>>>getUsers"),r.text=e[0].name,r.value=e[0].id,r.disable=!1,r.type="select",r.selData={source:e&&e.map(function(e){return{key:e.name,value:e.id}})}}).catch(function(e){return console.log(e)})),e[r.attr]){if(r.value=e[r.attr],r.text=e[r.attr],"orderNo"===a.attr&&(r.text=r.value&&r.value.substring(0,8),r.value=r.value&&r.value.substring(9,r.value.length),r.disable=!0),"gender"===r.attr&&(r.text=e[r.attr].name,r.value=e[r.attr].code),"shoppingWay"!==r.attr&&"paymentWay"!==r.attr&&"deliveryPlaceType"!==r.attr||(r.text=e[r.attr].name,r.value=e[r.attr].code),"contractUrl"===r.attr){var o=r.value||[];r.value=o.map(function(e){return{base64:"",file:{},name:"",progress:1,response:{},responseHeaders:"",size:150797,status:"success",url:e}})}if("certificateUrl"===r.attr){var f=r.value||[];r.value=f.map(function(e){return{base64:"",file:{},name:"",progress:1,response:{},responseHeaders:"",size:150797,status:"success",url:e}})}if("depositVoucherUrl"===r.attr){var T=r.value||[];r.value=T.map(function(e){return{base64:"",file:{},name:"",progress:1,response:{},responseHeaders:"",size:150797,status:"success",url:e}})}r.attr,"money"===r.type&&(r.text=g()(e[r.attr]).format("0,0.00"),r.value=g()(e[r.attr]).format("0.00"))}var k=!1;a.rulesObj&&a.rulesObj.forEach(function(e){"required"===e.type&&(k=!0)});var U=Object($.a)(a);switch(k&&(r.required=k),U&&(r.rules=U),a.attr){case"vehicleModelId":r.selData.source=n.map(function(e){return{key:e.name,value:e.code}});break;case"intentionType":case"intentionGrade":r.selData.source=c.map(function(e){return{key:e.name,value:e.code}});break;case"shoppingWay":r.selData.source=u.map(function(e){return{key:e.name,value:e.code}});break;case"appearance":r.selData=l;break;case"interior":r.selData=i;break;case"gender":r.selData.source=d.map(function(e){return{key:e.name,value:e.code}});break;case"origin":r.selData.source=p.map(function(e){return{key:e.name,value:e.code}});break;case"type":r.selData.source=m.map(function(e){return{key:e.name,value:e.code}});break;case"paymentWay":r.selData.source=v&&v.map(function(e){return{key:e.name,value:e.code}});break;case"deliveryPlaceType":r.selData.source=y&&y.map(function(e){return{key:e.name,value:e.code}});break;case"orderType":r.selData.source=h&&h.map(function(e){return{key:e.name,value:e.code}})}"contractUrl"===r.attr&&t.isOnline||s.push(r)}),t.form.data=s,console.log(t.form.data,"----------\x3e>>>>>>>>>"),"edit"===t.form.type&&t.form.data.forEach(function(a){"deliveryPlaceType"===a.attr&&("0"===t.$ChangeType.xToType(a.value,"string")?t.onSelect({type:"deliveryPlaceType",value:"0"},!0):t.onSelect({type:"deliveryPlaceType",value:"1",address:e.deliveryPlace},!0))}),["3","4","5","6","7"].indexOf(t.orderType)>-1&&t.form.data.forEach(function(e,a){"deliveryPlaceType"===e.attr&&(t.form.data[a].text="客户4S店自提",t.form.data[a].value=1,t.form.data[a].disable=!0),"deliveryPlace"===e.attr&&(t.form.data[a].disable=!1)}),t.initData=f()(t.form)}).catch(function(e){console.log(e,"==============================>err")});case 23:case"end":return a.stop()}},a,t)}))()}}},D={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("div",{staticClass:"input-box2"},[a("cube-scroll",[a("div",{staticClass:"content"},[e._l(e.form.data,function(t,r){return["customerId"===t.attr?a("div",{key:"index"+r,staticClass:"id-box"},e._l(e.form.info,function(t,r){return a("div",{key:"index2"+r,staticClass:"in-box",class:{self:50===t.columnWidth}},[a("yi-input",e._b({ref:"info",refInFor:!0,attrs:{value:t.value,indent:!0,selData:t.selData||null,clearMR:50===t.columnWidth,disable:!0},on:{"update:value":function(a){e.$set(t,"value",a)}},model:{value:t.text,callback:function(a){e.$set(t,"text",a)},expression:"item1.text"}},"yi-input",t,!1))],1)})):"groupHeader"===t.type?a("div",{key:"index"+r,staticClass:"section-title section-margin-top"},[e._v("\n            "+e._s(t.title)+"\n          ")]):a("div",{key:"index"+r,staticClass:"in-box",class:{self:50===t.columnWidth}},[a("yi-input",e._b({ref:"va",refInFor:!0,class:{hide:"orderNo"===t.attr},attrs:{value:t.value,indent:!0,selData:t.selData||null,clearMR:50===t.columnWidth},on:{"update:value":function(a){e.$set(t,"value",a)},onCarModel:e.onCarModel,onGetName:e.onGetName,onSelect:e.onSelect,onChangeMoney:e.onChangeMoney},model:{value:t.text,callback:function(a){e.$set(t,"text",a)},expression:"item.text"}},"yi-input",t,!1))],1)]}),e._v(" "),a("div",{staticClass:"space-box"})],2)])],1),e._v(" "),a("yi-btn-box",{attrs:{name:e.btnName},on:{onBtnClick:e.onBtnClick}})],1)},staticRenderFns:[]};var I=a("VU/8")(O,D,!1,function(e){a("4KJJ")},"data-v-5a667da4",null);t.default=I.exports}});