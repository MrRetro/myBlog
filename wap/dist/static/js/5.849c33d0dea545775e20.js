webpackJsonp([5],{"+dth":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("pFYg"),o=a.n(r),n=a("Dd8w"),i=a.n(n),c=a("//Fk"),l=a.n(c),s=a("mvHQ"),d=a.n(s),u=a("Xxa5"),m=a.n(u),f=a("exGp"),p=a.n(f),v=a("ViqS"),h=a.n(v),g=a("FWz8"),b=a("W8/A"),x=a("1CjK"),y=a("OT9B"),C=a("3r8y"),I=a("Gtft"),k=a("N6PA"),D=a("6D10"),M=a("t5DY"),N={name:"clue-add",extends:C.a,created:function(){var e=this;this.$nextTick(p()(m.a.mark(function t(){var a,r,o;return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$store.dispatch("order/clearData"),!(a=e.params.clueInfo&&e.params.clueInfo.id)){t.next=8;break}return t.next=5,Object(M.g)({module:"clues",id:e.params.clueInfo.id});case 5:r=t.sent,console.log("clueInfo==>",a),e.params.clueInfo=r;case 8:e.params=e.$route.params,(o=e.params)&&o.id?(e.id=o.id,e.form.type="edit"):e.form.type="add","add"===e.form.type?e.getPage({}):Object(g.i)(e.id).then(function(){var t=p()(m.a.mark(function t(a){var r,o;return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.edit=a,e.params.type="edit",e.params.oldData=a,console.log(a,"--------------------0203"),!(r=a&&a.clueId)){t.next=11;break}return t.next=8,Object(M.g)({module:"clues",id:r});case 8:o=t.sent,console.log("clueInfo==>",r),e.params.clueInfo=o;case 11:e.getPage(a);case 12:case"end":return t.stop()}},t,e)}));return function(e){return t.apply(this,arguments)}}()).catch(function(e){console.log(e)});case 12:case"end":return t.stop()}},t,e)})))},data:function(){return{initData:null,form:{type:"add",info:{name:"",mobile:"",gender:""},customer:{attr:"customerPK",title:"客户主键",text:null,hide:!0},carName:{attr:"carName",title:"车型信息",text:null,hide:!0},data:[]},isIntention:!0,isContactClue:!1,isShowContact:!1}},methods:{isEdit:function(){return this.initData!==d()(this.form)},onBtnClick:function(){var e=this;console.log("新建订单1");var t=[];this.$refs.va.forEach(function(e){e.rules&&!Object(D.j)(e)&&!1===e.hide&&t.push(e.changeV())}),l.a.all(t).then(function(t){var a;if(t.every(function(e){return e})){console.log(e.form,"校验成功并提交数据");var r={};if(e.form.data.forEach(function(t){if("group"!==t.attr){var a="";a=t.value?t.value:0===t.value?0:t.text,console.log(a,"item"),"vehicleModelId"===t.attr&&(e.form.carName.text=t.text),r[t.attr]=a}}),console.log(r,"==>items"),e.isIntention)return e.$AlertUtil.showToast({txt:"车型信息不明确",type:"warn"}),!1;var o={};o.name=r.name,o.mobile=r.mobile,o.gender=r.gender,Object(y.b)(o).then((a=p()(m.a.mark(function t(a){var r,n;return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$store.dispatch("order/getCustomerNo",a.id),e.form.customer.text=a.id,e.form.data.push(e.form.customer),e.form.data.push(e.form.carName),console.log(e.form.data,"==>dataOne"),console.log(o.name,"===",e.form.info.name),console.log(o.mobile,"===",e.form.info.mobile),console.log(o.gender,"===",e.form.info.gender),e.params.clueInfo||e.isShowContact){t.next=14;break}return r={attr:"cluePK",type:"selClue",title:"选择线索",text:"FJM02181101001I",value:"40288a4866ce5cb50166ce6702360016",placeholder:"请选择线索",indent:!0,columnWidth:120,selData:{source:[],selectedKey:""},disable:!0,rules:{},hide:!0},t.next=12,Object(g.h)({id:a.mobile});case 12:(n=t.sent)&&(e.isContactClue=!0,I.a.confirm({message:"经纪人["+n.brokerName+"]已经提交该线索，是否以该线索进行签约。",title:"提示",buttonLabels:["否","是"],onSuccess:function(t){0===t.buttonIndex?e.$router.back():(e.isShowContact=!0,e.isContactClue=!1,r.text=n.clueNo,r.value=n.id,e.form.data.push(r),e.onBtnClick())}}));case 14:e.isContactClue||(!a.isExist||o.name===e.form.info.name&&o.mobile===e.form.info.mobile&&o.gender===e.form.info.gender?e.$RouteUtil.orderAddThree(i()({},e.params,{info:a,data1:e.form.data})):(o.id=a.id,e.params.oldData&&(e.params.oldData.customerId=a.id),o.isOverride=!0,e.$RouteUtil.orderAddTwo(i()({},e.params,{info:a,newInfo:o,data1:e.form.data}))),setTimeout(function(){e.isContactClue=!1,e.isShowContact=!1},1e3));case 15:case"end":return t.stop()}},t,e)})),function(e){return a.apply(this,arguments)})).catch(function(e){console.log(e,"888")})}return!1})},onCarModel:function(e,t){var a=this;console.log(e,"2233344"),"dim"===e.type?this.isIntention=!0:this.isIntention=!1;var r=e.data.innerColors,o=e.data.outerColors;this.form.data.forEach(function(n,i){"appearance"===n.attr&&(a.form.data[i].carId=e.data.id,t||(a.form.data[i].text="",a.form.data[i].value=""),a.form.data[i].selData=o,a.form.data[i].disable=!1),"interior"===n.attr&&(a.form.data[i].carId=e.data.id,t||(a.form.data[i].text="",a.form.data[i].value=""),a.form.data[i].selData=r,a.form.data[i].disable=!1),"indicativePrice"===n.attr&&(a.form.data[i].text=h()(1e4*e.data.indicativePrice).format("0,0.00"),a.form.data[i].value=h()(1e4*e.data.indicativePrice).format("0.00"))}),t&&(this.initData=d()(this.form)),console.log(this.form,"2233355")},selClue:function(e){var t=this;console.log(e," 123 "),this.form.data.forEach(function(a,r){if("vehicleModelId"===a.attr&&e.carName&&e.vehicleModelId&&(t.form.data[r].text=e.carName,t.form.data[r].value=e.vehicleModelId),"appearance"===a.attr&&e.appearance)try{var o=JSON.parse(e.appearance);t.form.data[r].text=o&&o.name,t.form.data[r].value=o||null}catch(e){console.log(e)}if("interior"===a.attr&&e.interior)try{var n=JSON.parse(e.interior),i=n&&n.colors&&n.colors[0].name;n.colors&&n.colors[1]&&(i+="/"+n.colors[1].name),t.form.data[r].text=i,t.form.data[r].value=n||null}catch(e){console.log(e)}if("edit"!==t.form.type&&("name"===a.attr&&(e.name||e.customerName)&&(t.form.data[r].text=e.name||e.customerName,t.form.data[r].value=e.name||e.customerName,t.form.info.name=t.form.data[r].value),"mobile"===a.attr&&(e.mobile||e.customerMobile)&&(t.form.data[r].text=e.mobile||e.customerMobile,t.form.data[r].value=e.mobile||e.customerMobile,t.form.info.mobile=t.form.data[r].value),"gender"===a.attr&&(e.gender||e.customerGender))){var c=e.gender&&e.gender.name||e.customerGender&&e.customerGender.name,l=e.gender&&e.gender.code||e.customerGender&&e.customerGender.code;t.form.data[r].text=c,t.form.data[r].value=l,t.form.info.gender=l}"shoppingWay"===a.attr&&e.shoppingWay&&(t.form.data[r].text=e.shoppingWay.name,t.form.data[r].value=e.shoppingWay.code),"indicativePrice"===a.attr&&e.indicativePrice&&(t.form.data[r].text=h()(1e4*e.indicativePrice).format("0,0.00"),t.form.data[r].value=h()(1e4*e.indicativePrice).format("0,0.00"))}),e.vehicleModelId&&Object(b.f)(e.vehicleModelId).then(function(e){console.log(e,"res1"),t.onCarModel({data:e},!0)}).catch(function(e){return console.log(e)})},onSelect:function(e){var t=this;switch(console.log(e,"type"),e.value=this.$ChangeType.xToType(e.value,"string"),console.log(o()(e.value)),e.type){case"orderCustomerType":"0"===e.value&&this.form.data.forEach(function(e,a){return"name"===e.attr&&(t.form.data[a].title="客户姓名",t.form.data[a].placeholder="请输入客户姓名"),"gender"===e.attr&&(t.form.data[a].title="客户性别"),"idNumber"===e.attr&&(t.form.data[a].title="身份证"),"proxyName"===e.attr||"unifiedSocialCreditCode"===e.attr?(t.form.data[a].hide=!0,!1):(t.form.data[a].hide=!1,!1)}),"1"===e.value&&this.form.data.forEach(function(e,a){return"name"===e.attr&&(t.form.data[a].title="公司名称",t.form.data[a].placeholder="请输入公司名称"),"gender"===e.attr&&(t.form.data[a].title="代理人性别"),"idNumber"===e.attr&&(t.form.data[a].title="代理人身份证"),t.form.data[a].hide=!1,!1})}},getPage:function(e){var t=this;console.log(e);var a=this.menu,r=a.clueAdditionalConfiguration,o=a.clueIntentionType,n=a.clueShoppingWay,i=a.gender,c=a.customerOrigin,l=a.customerType,s=[{code:0,name:"个人"},{code:1,name:"公司"}];Object(g.g)().then(function(a){var u=t.params.clueInfo;console.log(a,"=========================>success1");var m=[];a.forEach(function(e){console.log(e),"create-order"===e.code&&"add"===t.form.type?m=e.fields:"edit-order"===e.code&&"edit"===t.form.type&&(m=e.fields)}),m.sort(function(e,t){return e.sort-t.sort}),console.log(m,"=========================>data1");var f=m.filter(function(e){return"step1"===e.description}),p=[];if(f.forEach(function(a){var d={attr:a.attr,type:x.a[a.configsObj.type],title:a.name,text:"",value:null,placeholder:a.configsObj.placeholder,indent:!0,columnWidth:a.columnWidth,selData:{source:[{key:"选项一",value:1},{key:"选项二",value:2}],selectedKey:"下单客户1"}};if("vehicleModelId"===d.attr&&(d.singleChoose=!0),"appearance"===d.attr&&(d.clearMR=!0),"indicativePrice"===d.attr&&(d.disable=!0),"appearance"!==d.attr&&"interior"!==d.attr||(d.isOther=!0),"amount"===d.attr&&(d.text="壹台",d.value=1),u&&"cluePK"===a.attr&&(d.text=u.clueNo,d.value=u.id,d.disable=!0),u&&2===u.intentionType.code&&"vehicleModelId"===a.attr){var m="模糊车型";u.carSeriesId&&(m=u.carName),d.text=m,d.value="",t.isIntention=!0}if(e[d.attr]){if(d.value=e[d.attr],d.text=e[d.attr],"vehicleModelId"===d.attr&&(d.text=e[d.attr].carName,d.value=e[d.attr].vehicleModelId),"orderCustomerType"===d.attr&&(d.text=e[d.attr].name,d.value=e[d.attr].code),"name"===d.attr&&(t.form.info.name=e[d.attr]),"mobile"===d.attr&&(t.form.info.mobile=e[d.attr]),"gender"===d.attr&&(d.text=e[d.attr].name,d.value=e[d.attr].code,t.form.info.gender=e[d.attr].code),"amount"===d.attr&&(d.text=Object(D.a)(e[d.attr]),d.value=e[d.attr],d.disable=!0),"appearance"===d.attr)try{var f=e[d.attr];"string"==typeof f?(d.text=JSON.parse(f).name,d.value=JSON.parse(f)):(d.text=f.name,d.value=f),console.log(e)}catch(e){console.log(e,"==>>>>>>")}if("interior"===d.attr)try{var v=e[d.attr];"string"==typeof v&&(v=JSON.parse(v));var g=JSON.parse(e[d.attr]).colors[0].name;JSON.parse(e[d.attr]).colors[1]&&(g+="/"+JSON.parse(e[d.attr]).colors[1].name),d.text=g,d.value=v}catch(e){d.text=null}"indicativePrice"===d.attr&&e[d.attr]&&(d.text=h()(e[d.attr]).format("0,0.00"),d.value=h()(e[d.attr]).format("0,0.00"))}var b=!1;a.rulesObj&&a.rulesObj.forEach(function(e){"required"===e.type&&(b=!0)});var y=Object(k.a)(a);switch(b&&(d.required=b),y&&(d.rules=y),a.attr){case"orderCustomerType":d.selData.source=s.map(function(e){return{key:e.name,value:e.code}});break;case"vehicleModelId":d.selData.source=r.map(function(e){return{key:e.name,value:e.code}});break;case"intentionType":case"intentionGrade":d.selData.source=o.map(function(e){return{key:e.name,value:e.code}});break;case"shoppingWay":d.selData.source=n.map(function(e){return{key:e.name,value:e.code}});break;case"appearance":case"interior":d.selData=null;break;case"gender":d.selData.source=i.map(function(e){return{key:e.name,value:e.code}});break;case"origin":d.selData.source=c.map(function(e){return{key:e.name,value:e.code}});break;case"type":d.selData.source=l.map(function(e){return{key:e.name,value:e.code}})}"选择线索"!==a.name&&"cluePK"!==a.attr||u?p.push(d):console.log("111")}),t.form.data=p,console.log(t.form.data,"----------\x3e>>>>>>>>>"),u&&t.selClue(u),"edit"===t.form.type){if(e.orderCustomerType){var v=t.$ChangeType.xToType(e.orderCustomerType.code,"string");t.onSelect({type:"orderCustomerType",value:v})}t.form.data.forEach(function(a,r){"vehicleModelId"===a.attr&&(t.form.data[r].text=e.carName,t.form.data[r].value=e.vehicleModelId.vehicleModelId,e.vehicleModelId&&"模糊意向"!==e.carName&&Object(b.f)(e.vehicleModelId.vehicleModelId).then(function(e){return t.onCarModel({data:e},!0)}).catch(function(e){return console.log(e)}))})}t.initData=d()(t.form)}).catch(function(e){console.log(e,"==============================>err")})}},activated:function(){I.a.setRight(),this.params.id?I.a.setTitle({title:"编辑合同"}):I.a.setTitle({title:"基础信息"})}},O={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("div",{staticClass:"input-box2"},[a("cube-scroll",[a("div",{staticClass:"content"},[e._l(e.form.data,function(t,r){return["customerId"===t.attr?a("div",{key:"index"+r,staticClass:"id-box"},e._l(e.form.info,function(t,r){return a("div",{key:"index2"+r,staticClass:"in-box",class:{self:50===t.columnWidth}},[a("yi-input",e._b({ref:"info",refInFor:!0,attrs:{value:t.value,indent:!0,selData:t.selData||null,clearMR:50===t.columnWidth,disable:!0},on:{"update:value":function(a){e.$set(t,"value",a)}},model:{value:t.text,callback:function(a){e.$set(t,"text",a)},expression:"item1.text"}},"yi-input",t,!1))],1)})):"groupHeader"===t.type?a("div",{key:"index"+r,staticClass:"section-title section-margin-top"},[e._v("\n            "+e._s(t.title)+"\n          ")]):a("div",{key:"index"+r,staticClass:"in-box",class:{self:50===t.columnWidth}},[a("yi-input",e._b({ref:"va",refInFor:!0,attrs:{value:t.value,indent:!0,selData:t.selData||null},on:{"update:value":function(a){e.$set(t,"value",a)},"update:selData":function(a){e.$set(t,"selData || null",a)},onCarModel:e.onCarModel,selClue:e.selClue,onSelect:e.onSelect},model:{value:t.text,callback:function(a){e.$set(t,"text",a)},expression:"item.text"}},"yi-input",t,!1))],1)]}),e._v(" "),a("div",{staticClass:"space-box"})],2)])],1),e._v(" "),a("yi-btn-box",{attrs:{name:"下一步"},on:{onBtnClick:e.onBtnClick}})],1)},staticRenderFns:[]};var T=a("VU/8")(N,O,!1,function(e){a("mHoC")},"data-v-3d9d388b",null);t.default=T.exports},mHoC:function(e,t){}});